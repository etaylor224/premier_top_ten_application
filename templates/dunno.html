<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tournament Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <h1 class="mb-4">Tournament Results</h1>

    <form id="filterForm" class="row g-3 mb-4">
        <div class="col-md-2"><input type="text" name="school" class="form-control" placeholder="School"></div>
        <div class="col-md-2"><input type="text" name="belt_rank" class="form-control" placeholder="Belt Rank"></div>
        <div class="col-md-2"><input type="text" name="division" class="form-control" placeholder="Division"></div>
        <div class="col-md-2"><input type="text" name="event" class="form-control" placeholder="Event"></div>
        <div class="col-md-2"><input type="text" name="tournament_location" class="form-control" placeholder="Tournament Location"></div>
        <div class="col-md-2"><button class="btn btn-primary w-100" type="submit">Filter</button></div>
    </form>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Division ID</th>
                <th>Rank ID</th>
                <th>School ID</th>
                <th>Age</th>
                <th>Event ID</th>
                <th>Top Ten Rank</th>
                <th>Tournament ID</th>
                <th>Tournament Points</th>
                <th>Total Points</th>
                <th>Tournament Place</th>
            </tr>
        </thead>
        <tbody id="resultsTable">
            <tr><td colspan="7" class="text-center">Loading...</td></tr>
        </tbody>
    </table>

    <a href="/add_result" class="btn btn-success">Add New Result</a>

    <script>
        async function loadResults() {
            const response = await fetch(`/api/topten`);
            const data = await response.json();
            const tableBody = document.getElementById("resultsTable");
            tableBody.innerHTML = "";

            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center">No results found</td></tr>`;
                return;
            }

            data.forEach(r => {
                const row = `
                    <tr>
                            <td>${r.fname ?? ""}</td>
                            <td>${r.lname ?? ""}</td>
                            <td>${r.division ?? ""}</td>
                            <td>${r.belt_rank ?? ""}</td>
                            <td>${r.school ?? ""}</td>
                            <td>${r.age ?? ""}</td>
                            <td>${r.event ?? ""}</td>
                            <td>${r.top_ten_rank ?? ""}</td>
                            <td>${r.tournament ?? ""}</td>
                            <td>${r.tourn_pts ?? ""}</td>
                            <td>${r.total_pts ?? ""}</td>
                            <td>${r.tourn_place ?? ""}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Handle filter form
        document.getElementById("filterForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const params = new URLSearchParams(new FormData(this)).toString();
            loadResults("?" + params);
        });

        // Load initial results
        loadResults();
    </script>
</body>
</html>
